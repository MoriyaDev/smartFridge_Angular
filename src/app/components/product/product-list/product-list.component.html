<div class="title_container">
  <h2 class="title_page">מוצרים ב-{{ location | locationTranslate }}</h2>
</div>


<div class="search-container">
  <select [(ngModel)]="selectedCategory" (change)="filterProducts()">
    <option value="">כל הקטגוריות</option>
    <option *ngFor="let category of categories" [value]="category.id">
      {{ category.name }} (ID: {{ category.id }})
    </option>
  </select>

  <input type="text" placeholder="חפש מוצר..." [(ngModel)]="searchQuery" (input)="filterProducts()">

  <div class="fridge-light-container">
    <div class="fridge-light-strip">
      <div *ngFor="let dot of lightDots" [class.on]="isLightOn" class="light-dot"></div>
    </div>

    <button class="light-toggle-button" (click)="toggleLight()">
      {{ isLightOn ? '⚪ למצב שבת' : '⚫ למצב רגיל' }}
    </button>
  </div>
</div>


<div class="fridge-container" [ngClass]="{ 'freezer-background': location === 'Freezer' }">
  <div class="freezer-background">
    <div class="large-flakes"></div>
  </div>
  <div class="fridge-content">
    <button class="add-pro-button" (click)="toggleAddProductModal()">➕ הוסף מוצר</button>


    <div class="shelf" *ngFor="let shelf of shelves">
      @for (pro of shelf; track $index) {
      <div class="pro-item" [ngStyle]="{'background-image': getCategoryBackground(pro.categoryID),
                         'background-size': 'contain',
                         'background-position': 'bottom center',
                         'background-repeat': 'no-repeat'}" appExpiryHighlight [expiryDate]="pro.expiryDate">


        <button class="product-title" (click)="showDetails(pro)">
          <h3>{{ pro.name }}</h3>
        </button>
      </div>
      }

    </div>
  </div>
</div>

<div class="modal-overlay" *ngIf="isAddProductModalOpen">
  <div class="modal-container">
    <span class="close-button" (click)="toggleAddProductModal()">&times;</span>

    <app-add-product (productAdded)="toggleAddProductModal()" (close)="toggleAddProductModal()"></app-add-product>
  </div>
</div>

<app-product-details [isOpen]="isModalOpen" (close)="closeModal()" (updateSuccess)="onProductUpdated($event)"
  (delete)="deleteProduct($event)">
</app-product-details>

<app-product-details [product]="selectedProduct" [isOpen]="isModalOpen" (close)="closeModal()"
  (updateSuccess)="onProductUpdated($event)" (delete)="deleteProduct($event)">
</app-product-details>